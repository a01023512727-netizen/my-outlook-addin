<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>êµ¬ê¸€ ì‹œíŠ¸ ë·°ì–´</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 15px; margin: 0; background-color: #ffffff; }
    .header { color: #2b579a; font-size: 16px; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; border-bottom: 2px solid #2b579a; padding-bottom: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; border: 1px solid #e0e0e0; }
    th { background-color: #f3f3f3; color: #333; font-weight: bold; padding: 8px; border: 1px solid #e0e0e0; text-align: left; }
    td { padding: 8px; border: 1px solid #e0e0e0; color: #555; }
    tr:nth-child(even) { background-color: #fafafa; }
    tr:hover { background-color: #f0f7ff; }
    .loading { color: #666; font-size: 13px; font-style: italic; }
    .error { color: #b00020; font-size: 12px; white-space: pre-wrap; line-height: 1.4; }
  </style>
</head>
<body>
  <div class="header">ğŸ“Š ì‹¤ì‹œê°„ ì‹œíŠ¸ ë°ì´í„°</div>
  <div id="table-container" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <script>
    const SHEET_ID = '1DW0Rl4lDhw8lfEF0lRxXWA21WHLBSLNVrOq4eCwQG4w';
    const DATA_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    Office.onReady(() => {
      loadSheetData();
    });

    async function loadSheetData() {
      const container = document.getElementById('table-container');

      try {
        const res = await fetch(DATA_URL, {
          method: "GET",
          // Outlook í™˜ê²½ì—ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ê°œì…í•˜ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„
          redirect: "follow",
          cache: "no-store"
        });

        if (!res.ok) {
          throw new Error(`HTTP ${res.status} ${res.statusText}`);
        }

        const text = await res.text();

        // gviz ì‘ë‹µì´ ì•„ë‹Œ ê²½ìš°(ë¡œê·¸ì¸ í˜ì´ì§€/ì°¨ë‹¨/ì—ëŸ¬ HTML)ë„ ì¡ì•„ë‚´ê¸°
        if (!text || text.length < 60) {
          throw new Error("ì‘ë‹µì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. (ì°¨ë‹¨ ë˜ëŠ” ë¹ˆ ì‘ë‹µ)");
        }
        if (!text.startsWith("/*O_o*/") && text.indexOf("google.visualization") === -1) {
          // ê°€ë” HTMLì´ ë–¨ì–´ì§€ëŠ” ê²½ìš°ê°€ ìˆì–´ ë””ë²„ê·¸ë¥¼ ìœ„í•´ ì•ë¶€ë¶„ì„ ë…¸ì¶œ
          throw new Error("ì˜ˆìƒí•œ gviz ì‘ë‹µ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\nì‘ë‹µ ì•ë¶€ë¶„:\n" + text.slice(0, 200));
        }

        // êµ¬ê¸€ JSONì˜ ë¶ˆí•„ìš”í•œ ì•ë’¤ í…ìŠ¤íŠ¸ ì œê±°
        const jsonText = text.substring(47).slice(0, -2);
        const json = JSON.parse(jsonText);

        let tableHtml = '<table><thead><tr>';

        json.table.cols.forEach(col => {
          tableHtml += `<th>${escapeHtml(col.label || '')}</th>`;
        });
        tableHtml += '</tr></thead><tbody>';

        json.table.rows.forEach(row => {
          tableHtml += '<tr>';
          row.c.forEach(cell => {
            const value = cell ? (cell.f ? cell.f : cell.v) : '';
            tableHtml += `<td>${escapeHtml(String(value ?? ''))}</td>`;
          });
          tableHtml += '</tr>';
        });

        tableHtml += '</tbody></table>';

        container.classList.remove('loading');
        container.innerHTML = tableHtml;

      } catch (err) {
        console.error(err);
        container.classList.remove('loading');
        container.classList.add('error');
        container.innerHTML =
          "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨.\n\n" +
          "ì—ëŸ¬ ë©”ì‹œì§€:\n" + (err && err.message ? err.message : String(err)) + "\n\n" +
          "íŒíŠ¸:\n" +
          "- Outlook Add-inì€ ì™¸ë¶€ ë„ë©”ì¸ ìš”ì²­ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”.\n" +
          "- manifestì˜ AppDomainsì— docs.google.com ë¿ ì•„ë‹ˆë¼ docs.googleusercontent.comë„ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”.\n" +
          "- ì‹œíŠ¸ê°€ [íŒŒì¼ > ê³µìœ  > ì›¹ì— ê²Œì‹œ] ë˜ì–´ ìˆëŠ”ì§€ë„ í™•ì¸í•´ì£¼ì„¸ìš”.";
      }
    }

    function escapeHtml(s) {
      return s
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
  </script>
</body>
</html>
